parameters:
  targetBranch: main
  topicBranchId: ''
  componentJsonValues: ''

steps:
# Creates VS insertion PRs using the VS drops containing the workloads and vsman files.
# Documentation: https://devdiv.visualstudio.com/DevDiv/_wiki/wikis/DevDiv.wiki/635/Overview?anchor=**build-pipeline**
# YAML reference: https://dev.azure.com/devdiv/Engineering/_git/MicroBuild?path=/src/Tasks/InsertVsPayload/task.json
- task: MicroBuildInsertVsPayload@5
  displayName: 'ðŸŸ£ Create VS insertion: ${{ parameters.targetBranch }}'
  inputs:
    # Connection: https://dnceng.visualstudio.com/internal/_settings/adminservices?resourceId=5708f1c1-8fb7-4722-a643-020cf89ee26f
    # Docs: https://devdiv.visualstudio.com/DevDiv/_wiki/wikis/DevDiv.wiki/40477/Insert-with-a-WIF-Service-Connection
    ConnectedServiceName: MicroBuildInsertionVS
    TargetBranch: ${{ parameters.targetBranch }}
    # Starting with 'temp' allows this branch to be cleaned up automatically by the VS repo branch policies.
    InsertionTopicBranch: temp/DotNet-SDK-Workloads/${{ parameters.targetBranch }}/${{ parameters.topicBranchId }}
    TeamName: $(_TeamName)
    TeamEmail: dotnetdevexcli@microsoft.com
    InsertionPayloadName: 'DotNet-SDK-Workloads ($(Build.SourceBranchName):$(Build.BuildNumber))'
    ComponentJsonValues: ${{ parameters.componentJsonValues }}
    AllowTopicBranchUpdate: true
    # This is the name of our DevDiv alias.
    InsertionReviewers: Dotnet Core SDK and CLI
    InsertionBuildPolicies: Request Perf DDRITs
    # Documentation: https://devdiv.visualstudio.com/DevDiv/_wiki/wikis/DevDiv.wiki/631/Copy-Commit-Details-to-PR
    AddCommitsToPR: true
    # Documentation: https://devdiv.visualstudio.com/DevDiv/_wiki/wikis/DevDiv.wiki/634/Link-Work-Items-to-PR
    LinkWorkItemsToPR: false
    # Documentation: https://devdiv.visualstudio.com/DevDiv/_wiki/wikis/DevDiv.wiki/638/Set-AutoComplete-on-an-Insertion
    InsertAutoComplete: true
  env:
    # This is required. See: https://devdiv.visualstudio.com/DevDiv/_wiki/wikis/DevDiv.wiki/40477/Insert-with-a-WIF-Service-Connection?anchor=steps-to-use-a-wif-service-connection-in-the-insert-vs-task
    SYSTEM_ACCESSTOKEN: $(System.AccessToken)